<!-- inventory-details.html (REPLICATED FROM users-details, adapted for Inventory) -->

<div class="inventory-details-page">
  <!-- Loading State -->
  <ng-container *ngIf="loading">
    <div class="loading-container">
      <div class="loading-spinner">
        <mat-spinner diameter="64"></mat-spinner>
      </div>
      <p class="loading-text">Loading inventory details...</p>
    </div>
  </ng-container>

  <!-- Error State -->
  <ng-container *ngIf="!loading && error">
    <div class="error-container reveal-on-scroll">
      <div class="error-icon">
        <mat-icon>error_outline</mat-icon>
      </div>
      <h2 class="error-title">Oops! Something went wrong</h2>
      <p class="error-message">{{ error }}</p>
      <button mat-flat-button class="error-action" (click)="back()">
        <mat-icon>arrow_back</mat-icon>
        Go Back to Inventory
      </button>
    </div>
  </ng-container>

  <!-- Inventory Profile -->
  <ng-container *ngIf="!loading && inventory">
    <!-- Full-Width Hero Section -->
    <section class="profile-hero reveal-on-scroll">
      <div class="hero-background">
        <div class="hero-gradient"></div>
        <div class="hero-pattern"></div>
      </div>

      <div class="hero-content-wrapper">
        <!-- Back Button in Hero -->
        <div class="hero-navigation">
          <button mat-button class="back-btn-hero" (click)="back()">
            <mat-icon>arrow_back</mat-icon>
            <span>Back to Inventory</span>
          </button>
        </div>

        <!-- Main Profile Section -->
        <div class="hero-main-section">
          <div class="hero-left">
            <div class="profile-avatar-large">
              <span class="avatar-text">{{ initials }}</span>
              <div class="avatar-ring"></div>
              <div class="avatar-glow"></div>
            </div>

            <div class="profile-header-info">
              <div class="profile-header-top">
                <h1 class="profile-name">{{ fullName }}</h1>

                <div
                  class="activity-indicator"
                  [class.online]="activityStatus === 'online'"
                  [class.recent]="activityStatus === 'recent'"
                  [class.away]="activityStatus === 'away'"
                  [class.inactive]="activityStatus === 'inactive'"
                  [matTooltip]="activityStatusLabel"
                >
                  <span class="indicator-dot"></span>
                  <span class="indicator-label">{{ activityStatusLabel }}</span>
                </div>
              </div>

              <p class="profile-username">
                <mat-icon>directions_car</mat-icon>
                {{ subtitleLine }}
              </p>

              <div class="profile-badges-row">
                <span
                  class="status-badge"
                  [class.active]="inventory.active"
                  [class.inactive]="!inventory.active"
                >
                  <mat-icon>{{ inventory.active ? 'check_circle' : 'cancel' }}</mat-icon>
                  {{ inventory.active ? 'Active Inventory' : 'Inactive Inventory' }}
                </span>

                <span
                  class="status-badge"
                  [class.verified]="hasJSON"
                  [class.unverified]="!hasJSON"
                >
                  <mat-icon>{{ hasJSON ? 'integration_instructions' : 'pending' }}</mat-icon>
                  {{ hasJSON ? 'Product JSON Present' : 'No Product JSON' }}
                </span>

                <span class="status-badge id-badge">
                  <mat-icon>fingerprint</mat-icon>
                  ID: {{ inventory.inventoryId }}
                </span>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="hero-actions">
            <button mat-flat-button class="hero-action-btn primary" (click)="editInventory()">
              <mat-icon>edit</mat-icon>
              <span>Edit Inventory</span>
            </button>

            <button mat-stroked-button class="hero-action-btn secondary" (click)="back()">
              <mat-icon>inventory_2</mat-icon>
              <span>Inventory List</span>
            </button>

            <button
              mat-stroked-button
              class="hero-action-btn warning"
              (click)="toggleInventoryStatus()"
              *ngIf="inventory.active"
            >
              <mat-icon>block</mat-icon>
              <span>Deactivate</span>
            </button>

            <button
              mat-stroked-button
              class="hero-action-btn success"
              (click)="toggleInventoryStatus()"
              *ngIf="!inventory.active"
            >
              <mat-icon>check_circle</mat-icon>
              <span>Activate</span>
            </button>
          </div>
        </div>

        <!-- Hero Stats Grid -->
        <div class="hero-stats-grid">
          <div class="hero-stat-card">
            <div class="stat-icon-wrapper">
              <mat-icon>schedule</mat-icon>
            </div>
            <div class="stat-details">
              <div class="stat-label">Last Update</div>
              <div class="stat-value">{{ formatLastLogin(lastTouched) }}</div>
            </div>
            <div class="stat-decoration"></div>
          </div>

          <div class="hero-stat-card">
            <div class="stat-icon-wrapper">
              <mat-icon>event</mat-icon>
            </div>
            <div class="stat-details">
              <div class="stat-label">Created</div>
              <div class="stat-value">{{ getAccountAgeDetailed() }}</div>
            </div>
            <div class="stat-decoration"></div>
          </div>

          <div class="hero-stat-card">
            <div class="stat-icon-wrapper">
              <mat-icon>cake</mat-icon>
            </div>
            <div class="stat-details">
              <div class="stat-label">Inventory Age</div>
              <div class="stat-value">{{ getAccountAge() }}</div>
            </div>
            <div class="stat-decoration"></div>
          </div>

          <div class="hero-stat-card">
            <div class="stat-icon-wrapper">
              <mat-icon>collections</mat-icon>
            </div>
            <div class="stat-details">
              <div class="stat-label">Files Attached</div>
              <div class="stat-value">{{ docs.length }} {{ docs.length === 1 ? 'File' : 'Files' }}</div>
            </div>
            <div class="stat-decoration"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Enhanced Details Grid -->
    <div class="details-container">
      <div class="details-grid">
        <!-- Vehicle / Inventory Information Card -->
        <section class="detail-card reveal-on-scroll">
          <div class="card-header">
            <div class="card-icon-wrapper">
              <mat-icon>inventory_2</mat-icon>
            </div>
            <div class="card-title-group">
              <h2 class="card-title">Inventory Information</h2>
              <p class="card-subtitle">Core inventory identifiers</p>
            </div>
          </div>

          <div class="card-body">
            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>fingerprint</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Inventory ID</div>
                <div class="detail-value">{{ inventory.inventoryId }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>qr_code_2</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Product ID</div>
                <div class="detail-value">{{ inventory.productId ?? '—' }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>confirmation_number</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Chassis No</div>
                <div class="detail-value mono">{{ inventory.chassisNo || '—' }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>badge</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Registration No</div>
                <div class="detail-value mono">{{ inventory.registrationNo || '—' }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>notes</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Description</div>
                <div class="detail-value">{{ inventory.description || '—' }}</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Product Snapshot Card -->
        <section class="detail-card reveal-on-scroll">
          <div class="card-header">
            <div class="card-icon-wrapper">
              <mat-icon>directions_car</mat-icon>
            </div>
            <div class="card-title-group">
              <h2 class="card-title">Product Snapshot</h2>
              <p class="card-subtitle">Parsed from product JSON</p>
            </div>
          </div>

          <div class="card-body">
            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>text_fields</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Display Name</div>
                <div class="detail-value">{{ productDisplayName }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>factory</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Make</div>
                <div class="detail-value">{{ productMake }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>precision_manufacturing</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Model</div>
                <div class="detail-value">{{ productModel }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>calendar_today</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Year</div>
                <div class="detail-value">{{ productYear }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>category</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Category</div>
                <div class="detail-value">{{ productCategory }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>verified_user</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Product JSON</div>
                <div class="detail-value">
                  <span class="inline-badge" [class.success]="hasJSON" [class.warning]="!hasJSON">
                    {{ hasJSON ? 'Present' : 'Missing' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Files Card -->
        <section class="detail-card reveal-on-scroll">
          <div class="card-header">
            <div class="card-icon-wrapper">
              <mat-icon>collections</mat-icon>
            </div>
            <div class="card-title-group">
              <h2 class="card-title">Files</h2>
              <p class="card-subtitle">Uploaded documents and images</p>
            </div>
          </div>

          <div class="card-body">
            <div class="files-busy" *ngIf="filesLoading">
              <mat-spinner diameter="24"></mat-spinner>
              <span>Loading files…</span>
            </div>

            <div class="empty-files" *ngIf="!filesLoading && !docs.length">
              <mat-icon>insert_drive_file</mat-icon>
              <span>No files uploaded yet.</span>
            </div>

            <div class="gallery" *ngIf="!filesLoading && docs.length">
              <div class="file-card" *ngFor="let d of docs; trackBy: trackByDoc">
                <div class="thumb" (click)="openUrl(d)" [class.clickable]="d.documentUrl">
                  <img *ngIf="isImage(d) && d.documentUrl" [src]="d.documentUrl" [alt]="displayName(d)" />
                  <div class="doc-icon" *ngIf="!isImage(d) || !d.documentUrl">
                    <mat-icon>insert_drive_file</mat-icon>
                  </div>
                </div>

                <div class="meta-row">
                  <div class="name" [title]="displayName(d)">{{ displayName(d) }}</div>
                  <div class="actions">
                    <button
                      mat-icon-button
                      class="open"
                      *ngIf="d.documentUrl"
                      (click)="openUrl(d)"
                      matTooltip="Open"
                    >
                      <mat-icon>open_in_new</mat-icon>
                    </button>

                    <button
                      mat-icon-button
                      class="remove"
                      (click)="remove(d)"
                      matTooltip="Remove"
                    >
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- System Information Card -->
        <section class="detail-card reveal-on-scroll">
          <div class="card-header">
            <div class="card-icon-wrapper">
              <mat-icon>settings</mat-icon>
            </div>
            <div class="card-title-group">
              <h2 class="card-title">System Information</h2>
              <p class="card-subtitle">Timestamps and system metadata</p>
            </div>
          </div>

          <div class="card-body">
            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>add_circle</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Created</div>
                <div class="detail-value">{{ formatDate(inventory.createdDate) }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>update</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Last Modified</div>
                <div class="detail-value">{{ formatDate(inventory.modifiedDate) }}</div>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon-box">
                <mat-icon>toggle_on</mat-icon>
              </div>
              <div class="detail-content">
                <div class="detail-label">Active Status</div>
                <div class="detail-value">
                  <span class="inline-badge" [class.success]="inventory.active" [class.warning]="!inventory.active">
                    {{ inventory.active ? 'Active' : 'Inactive' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Audit Trail Card (Full Width) -->
        <section class="detail-card audit-card reveal-on-scroll">
          <div class="card-header">
            <div class="card-icon-wrapper">
              <mat-icon>history</mat-icon>
            </div>
            <div class="card-title-group">
              <h2 class="card-title">Audit Trail</h2>
              <p class="card-subtitle">Inventory creation and modification history</p>
            </div>
          </div>

          <div class="card-body">
            <div class="audit-timeline">
              <div class="timeline-item">
                <div class="timeline-marker created">
                  <mat-icon>add_circle</mat-icon>
                </div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <h3 class="timeline-title">Inventory Created</h3>
                    <span class="timeline-date">{{ formatDate(inventory.createdDate) }}</span>
                  </div>
                  <p class="timeline-description">
                    Created by User ID: <span class="mono-highlight">{{ inventory.createdById || 'System' }}</span>
                  </p>
                </div>
              </div>

              <div class="timeline-item" *ngIf="inventory.modifiedById">
                <div class="timeline-marker modified">
                  <mat-icon>edit</mat-icon>
                </div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <h3 class="timeline-title">Last Modified</h3>
                    <span class="timeline-date">{{ formatDate(inventory.modifiedDate) }}</span>
                  </div>
                  <p class="timeline-description">
                    Modified by User ID: <span class="mono-highlight">{{ inventory.modifiedById }}</span>
                  </p>
                </div>
              </div>

              <div class="timeline-item" *ngIf="lastTouched">
                <div class="timeline-marker activity">
                  <mat-icon>update</mat-icon>
                </div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <h3 class="timeline-title">Last Updated</h3>
                    <span class="timeline-date">{{ formatLastLogin(lastTouched) }}</span>
                  </div>
                  <p class="timeline-description">
                    Inventory last updated {{ formatDate(lastTouched) }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Action Footer -->
    <div class="action-footer reveal-on-scroll">
      <div class="footer-left">
        <button mat-stroked-button class="footer-btn secondary" (click)="back()">
          <mat-icon>arrow_back</mat-icon>
          <span>Back to Inventory</span>
        </button>
      </div>

      <div class="footer-right">
        <button mat-stroked-button class="footer-btn danger" (click)="deleteInventory()">
          <mat-icon>delete</mat-icon>
          <span>Delete Inventory</span>
        </button>
        <button mat-flat-button class="footer-btn primary" (click)="editInventory()">
          <mat-icon>edit</mat-icon>
          <span>Edit Inventory</span>
        </button>
      </div>
    </div>
  </ng-container>
</div>
