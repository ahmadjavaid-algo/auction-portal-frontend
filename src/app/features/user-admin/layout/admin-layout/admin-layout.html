<div class="layout-container">
  <!-- Sidebar -->
  <aside [class.collapsed]="sidebarCollapsed" class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <a routerLink="dashboard" class="logo-link">
          <div class="logo-icon">
            <img
              src="https://media.licdn.com/dms/image/v2/C560BAQGJ-j7r23Z79Q/company-logo_200_200/company-logo_200_200/0/1656698792543/algoai_logo?e=2147483647&v=beta&t=QaHGa0R70yu1J352TZfGUk4z2PUigcta-pMyLIznFG8"
              alt="Logo"
            />
          </div>
          <div class="logo-text" *ngIf="!sidebarCollapsed">
            <span class="logo-name">Auction Portal</span>
            <span class="logo-subtitle">Admin Console</span>
          </div>
        </a>
      </div>

      <button class="toggle-btn" (click)="toggleSidebar()" [attr.aria-label]="sidebarCollapsed ? 'Expand sidebar' : 'Collapse sidebar'">
        <mat-icon>{{ sidebarCollapsed ? 'menu_open' : 'menu' }}</mat-icon>
      </button>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="nav-item">
        <div class="nav-icon">
          <mat-icon>space_dashboard</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Dashboard</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="users" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>people</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Users</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="roles" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>admin_panel_settings</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Roles</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="inspectors" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>verified_user</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Inspectors</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="bidders" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>gavel</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Bidders</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="emails" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>mail</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Emails</span>
        <div class="nav-indicator"></div>
      </a>

      <div class="nav-divider" *ngIf="!sidebarCollapsed"></div>

      <a routerLink="make" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>directions_car</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Product Config</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="products" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>category</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Products</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="inventory" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Inventory</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="auctions" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>price_change</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Auctions</span>
        <div class="nav-indicator"></div>
      </a>

      <a routerLink="inspection" routerLinkActive="active" class="nav-item">
        <div class="nav-icon">
          <mat-icon>fact_check</mat-icon>
        </div>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Inspection</span>
        <div class="nav-indicator"></div>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <div class="page-title">
          <h1>{{ currentPageTitle }}</h1>
        </div>
      </div>

      <div class="topbar-right">
        <!-- Notifications -->
        <div #notifHost class="notif-wrapper">
          <button class="topbar-btn notif-btn" (click)="toggleNotifications()" [class.has-unread]="unreadCount > 0">
            <mat-icon>notifications</mat-icon>
            <span class="notif-badge" *ngIf="unreadCount > 0">{{ unreadCount > 9 ? '9+' : unreadCount }}</span>
          </button>

          <div class="notif-dropdown" *ngIf="notifOpen">
            <div class="notif-header">
              <div class="notif-title">
                <mat-icon>notifications_active</mat-icon>
                <span>Notifications</span>
              </div>
              <div class="notif-actions">
                <span class="notif-count" *ngIf="unreadCount > 0">{{ unreadCount }} new</span>
                <button
                  type="button"
                  class="clear-all-btn"
                  *ngIf="notifications.length"
                  (click)="clearNotifications($event)"
                >
                  Clear all
                </button>
              </div>
            </div>

            <div class="notif-body">
              <div class="notif-list" *ngIf="notifications.length; else noNotifs">
                <button
                  type="button"
                  class="notif-item"
                  *ngFor="let n of notifications"
                  [class.unread]="!n.read"
                  (click)="onNotificationClick(n)"
                >
                  <div class="notif-icon">
                    <mat-icon>{{ getNotificationIcon(n.type) }}</mat-icon>
                  </div>
                  <div class="notif-content">
                    <div class="notif-title-row">
                      <span class="notif-title-text">{{ n.title }}</span>
                      <span class="notif-time">{{ formatNotificationTime(n.createdAt) }}</span>
                    </div>
                    <p class="notif-message">{{ n.message }}</p>
                  </div>
                  <div class="notif-indicator" *ngIf="!n.read"></div>
                </button>
              </div>

              <ng-template #noNotifs>
                <div class="notif-empty">
                  <mat-icon>notifications_none</mat-icon>
                  <span>No notifications</span>
                </div>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- User Profile -->
        <div #dropdown class="profile-wrapper" [class.open]="dropdownOpen" (click)="toggleDropdown()">
          <div class="profile-trigger">
            <div class="profile-avatar" [class.hovered]="dropdownOpen">
              <span class="avatar-text">{{ avatarInitials }}</span>
              <div class="avatar-ring"></div>
            </div>
            <div class="profile-info" *ngIf="!sidebarCollapsed">
              <span class="profile-name">{{ displayName }}</span>
              <span class="profile-role">Administrator</span>
            </div>
            <mat-icon class="profile-chevron">expand_more</mat-icon>
          </div>

          <div class="profile-dropdown" *ngIf="dropdownOpen">
            <div class="profile-dropdown-header">
              <div class="profile-dropdown-avatar">
                <span>{{ avatarInitials }}</span>
              </div>
              <div class="profile-dropdown-info">
                <div class="profile-dropdown-name">{{ displayName }}</div>
                <div class="profile-dropdown-role">Administrator</div>
              </div>
            </div>

            <div class="profile-dropdown-divider"></div>

            <div class="profile-dropdown-menu">
              <button type="button" class="profile-menu-item" (click)="changePassword()">
                <mat-icon>lock</mat-icon>
                <span>Change Password</span>
              </button>
              <button type="button" class="profile-menu-item logout" (click)="logout()">
                <mat-icon>logout</mat-icon>
                <span>Logout</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Routed Content -->
    <section class="page-shell" [class.full-bleed]="pageFullBleed">
      <router-outlet></router-outlet>
    </section>
  </main>
</div>