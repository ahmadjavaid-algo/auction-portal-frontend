<!-- Loader -->
<div class="loader" *ngIf="loading">
  <mat-progress-spinner diameter="50" mode="indeterminate"></mat-progress-spinner>
</div>

<!-- Error -->
<div class="err-box" *ngIf="!loading && error">
  <mat-icon>error_outline</mat-icon>
  <span>{{ error }}</span>
  <button mat-raised-button color="primary" (click)="refresh()">Retry</button>
</div>

<!-- PROFILE PAGE -->
<div class="profile-wrapper" *ngIf="!loading && !error && user">

  <!-- Page header -->
  <div class="page-header">
    <h1>Profile</h1>
    <button mat-stroked-button class="back-btn" (click)="back()">
      <mat-icon>arrow_back</mat-icon>
      Dashboard
    </button>
  </div>

  <!-- HERO CARD -->
  <section class="hero-card">
    <div class="hero-left">

      <!-- Animated avatar orbit -->
      <div class="avatar-orbit">
        <div class="orbit-ring"></div>
        <div class="avatar-circle">
          <span>{{ initials }}</span>
        </div>
      </div>

      <div class="hero-info">
        <h2>{{ user.firstName }} {{ user.lastName }}</h2>
        <p class="email">{{ user.email }}</p>

        <div class="tags">
          <span class="tag role">Inspector</span>
          <span class="tag verified" *ngIf="user.emailConfirmed">
            <mat-icon>verified</mat-icon>
            Verified
          </span>
        </div>

        <div class="actions">
          <button class="act-btn" (click)="changePassword()">
            <mat-icon>lock_reset</mat-icon>
            Change Password
          </button>

          <button class="act-btn" (click)="refresh()">
            <mat-icon>refresh</mat-icon>
            Refresh
          </button>

          <button class="act-btn danger" (click)="logout()">
            <mat-icon>logout</mat-icon>
            Logout
          </button>
        </div>
      </div>

    </div>
  </section>

  <!-- TABS -->
  <nav class="tabs">
    <button
      type="button"
      [class.active]="activeTab === 'overview'"
      (click)="setTab('overview')"
    >
      <mat-icon>dashboard</mat-icon>
      Overview
    </button>

    <button
      type="button"
      [class.active]="activeTab === 'activity'"
      (click)="setTab('activity')"
    >
      <mat-icon>timeline</mat-icon>
      Activity
    </button>

    <button
      type="button"
      [class.active]="activeTab === 'security'"
      (click)="setTab('security')"
    >
      <mat-icon>shield</mat-icon>
      Security
    </button>
  </nav>

  <!-- TAB PANELS -->
  <section class="tab-panels">

    <!-- OVERVIEW TAB -->
    <section class="tab-section" *ngIf="activeTab === 'overview'">

      <!-- Stats row -->
      <section class="stats-row">
        <div class="stat-box">
          <mat-icon>badge</mat-icon>
          <label>User ID</label>
          <p>{{ user.userId }}</p>
        </div>

        <div class="stat-box">
          <mat-icon>event</mat-icon>
          <label>Joined</label>
          <p>{{ user.createdDate | date: 'mediumDate' }}</p>
        </div>

        <div class="stat-box">
          <mat-icon>login</mat-icon>
          <label>Last Login</label>
          <p>{{ user.loginDate | date: 'medium' }}</p>
        </div>

        <div class="stat-box">
          <mat-icon>check_circle</mat-icon>
          <label>Status</label>
          <p>{{ user.active ? 'Active' : 'Inactive' }}</p>
        </div>
      </section>

      <!-- Detail cards -->
      <section class="detail-grid">
        <mat-card class="detail-card">
          <h2>Personal Details</h2>

          <div class="row">
            <span>Name</span>
            <strong>{{ user.firstName }} {{ user.lastName }}</strong>
          </div>
          <div class="row">
            <span>Email</span>
            <strong>{{ user.email }}</strong>
          </div>
          <div class="row">
            <span>Phone</span>
            <strong>{{ user.phoneNumber || '—' }}</strong>
          </div>
          <div class="row">
            <span>Address</span>
            <strong>{{ user.address1 || '—' }}</strong>
          </div>
        </mat-card>

        <mat-card class="detail-card">
          <h2>Account Details</h2>

          <div class="row">
            <span>Username</span>
            <strong>{{ user.userName }}</strong>
          </div>
          <div class="row">
            <span>Verified</span>
            <strong>{{ user.emailConfirmed ? 'Yes' : 'No' }}</strong>
          </div>
          <div class="row">
            <span>ID #</span>
            <strong>{{ user.identificationNumber || '—' }}</strong>
          </div>
          <div class="row">
            <span>Security Stamp</span>
            <strong>{{ user.securityStamp }}</strong>
          </div>
        </mat-card>
      </section>
    </section>

    <!-- ACTIVITY TAB -->
    <section class="tab-section" *ngIf="activeTab === 'activity'">
      <div class="timeline-card">
        <h2>Recent Activity</h2>
        <p class="timeline-sub">
          A quick snapshot of important events on your inspector account.
        </p>

        <ul class="timeline">
          <li *ngFor="let item of activity">
            <div class="timeline-dot" [class.success]="item.kind === 'success'"
                                     [class.info]="item.kind === 'info'"
                                     [class.warn]="item.kind === 'warn'"></div>

            <div class="timeline-line"></div>

            <div class="timeline-content">
              <div class="timeline-header">
                <span class="label">{{ item.label }}</span>
                <span
                  class="badge"
                  *ngIf="item.badge"
                  [class.success]="item.kind === 'success'"
                  [class.info]="item.kind === 'info'"
                  [class.warn]="item.kind === 'warn'"
                >
                  {{ item.badge }}
                </span>
              </div>
              <p class="meta">{{ item.meta }}</p>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- SECURITY TAB -->
    <section class="tab-section" *ngIf="activeTab === 'security'">
      <div class="security-grid">

        <mat-card class="security-card">
          <h2>Password & Login</h2>
          <p class="desc">
            Change your password regularly and avoid reusing passwords across different platforms.
          </p>

          <div class="sec-row">
            <span>Last login</span>
            <strong>{{ user.loginDate | date:'medium' }}</strong>
          </div>

          <button mat-raised-button color="primary" (click)="changePassword()">
            <mat-icon>lock_reset</mat-icon>
            Change Password
          </button>
        </mat-card>

        <mat-card class="security-card">
          <h2>Account Safety</h2>
          <p class="desc">
            Email verification helps us keep your account safe and send important inspection updates.
          </p>

          <div class="sec-row">
            <span>Email verified</span>
            <strong>{{ user.emailConfirmed ? 'Yes' : 'No' }}</strong>
          </div>

          <div class="sec-row">
            <span>Status</span>
            <strong>{{ user.active ? 'Active' : 'Inactive' }}</strong>
          </div>

          <div class="sec-hint">
            Keep your login details private and log out after finishing inspections on shared systems.
          </div>
        </mat-card>

      </div>
    </section>

  </section>
</div>
