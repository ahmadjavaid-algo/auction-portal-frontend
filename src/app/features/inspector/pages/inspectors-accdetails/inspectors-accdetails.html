<!-- Loading State -->
<div class="loading-state" *ngIf="loading">
  <div class="loading-container">
    <mat-progress-spinner diameter="64" color="primary"></mat-progress-spinner>
    <h3>Loading Profile</h3>
    <p>Preparing your account details...</p>
  </div>
</div>

<!-- Error State -->
<div class="error-state" *ngIf="!loading && error">
  <div class="error-icon">
    <mat-icon>error_outline</mat-icon>
  </div>
  <div class="error-content">
    <h3>Unable to Load Profile</h3>
    <p>{{ error }}</p>
    <button mat-flat-button color="primary" (click)="refresh()">Retry</button>
  </div>
</div>

<!-- Profile Page -->
<div class="profile-page" *ngIf="!loading && !error && user">


  <!-- Hero Card -->
  <section class="hero-card animate-on-scroll" style="animation-delay: 100ms">
    <div class="hero-content">

      <!-- Animated Avatar -->
      <div class="avatar-wrapper">
        <div class="avatar-ring"></div>
        <div class="avatar-circle">
          <span>{{ initials }}</span>
        </div>
      </div>

      <!-- User Info -->
      <div class="user-info">
        <h2>{{ user.firstName }} {{ user.lastName }}</h2>
        <p class="email">{{ user.email }}</p>

        <div class="badges">
          <span class="badge role">Inspector</span>
          <span class="badge verified" *ngIf="user.emailConfirmed">
            <mat-icon>verified</mat-icon>
            <span>Verified</span>
          </span>
        </div>

        <div class="actions">
          <button mat-stroked-button class="action-btn" (click)="changePassword()">
            <mat-icon>lock_reset</mat-icon>
            <span>Change Password</span>
          </button>

          <button mat-stroked-button class="action-btn" (click)="refresh()">
            <mat-icon>refresh</mat-icon>
            <span>Refresh</span>
          </button>

          <button mat-stroked-button class="action-btn danger" (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Logout</span>
          </button>
        </div>
      </div>

    </div>
  </section>

  <!-- Tabs Navigation -->
  <nav class="tabs-nav animate-on-scroll" style="animation-delay: 200ms">
    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'overview'"
      (click)="setTab('overview')"
    >
      <mat-icon>dashboard</mat-icon>
      <span>Overview</span>
    </button>

    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'activity'"
      (click)="setTab('activity')"
    >
      <mat-icon>timeline</mat-icon>
      <span>Activity</span>
    </button>

    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'security'"
      (click)="setTab('security')"
    >
      <mat-icon>shield</mat-icon>
      <span>Security</span>
    </button>
  </nav>

  <!-- Tab Content -->
  <div class="tab-content">

    <!-- Overview Tab -->
    <section class="tab-panel" *ngIf="activeTab === 'overview'">

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card animate-on-scroll" style="animation-delay: 300ms">
          <div class="stat-icon">
            <mat-icon>badge</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label">User ID</span>
            <span class="stat-value">{{ user.userId }}</span>
          </div>
        </div>

        <div class="stat-card animate-on-scroll" style="animation-delay: 350ms">
          <div class="stat-icon">
            <mat-icon>event</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label">Joined</span>
            <span class="stat-value">{{ user.createdDate | date: 'mediumDate' }}</span>
          </div>
        </div>

        <div class="stat-card animate-on-scroll" style="animation-delay: 400ms">
          <div class="stat-icon">
            <mat-icon>login</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label">Last Login</span>
            <span class="stat-value">{{ user.loginDate | date: 'short' }}</span>
          </div>
        </div>

        <div class="stat-card animate-on-scroll" style="animation-delay: 450ms">
          <div class="stat-icon" [class.active]="user.active">
            <mat-icon>{{ user.active ? 'check_circle' : 'cancel' }}</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-label">Status</span>
            <span class="stat-value">{{ user.active ? 'Active' : 'Inactive' }}</span>
          </div>
        </div>
      </div>

      <!-- Details Grid -->
      <div class="details-grid">
        <div class="detail-card animate-on-scroll" style="animation-delay: 500ms">
          <div class="card-header">
            <mat-icon>person</mat-icon>
            <h3>Personal Details</h3>
          </div>

          <div class="detail-row">
            <span class="label">Name</span>
            <span class="value">{{ user.firstName }} {{ user.lastName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Email</span>
            <span class="value">{{ user.email }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Phone</span>
            <span class="value">{{ user.phoneNumber || '—' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Address</span>
            <span class="value">{{ user.address1 || '—' }}</span>
          </div>
        </div>

        <div class="detail-card animate-on-scroll" style="animation-delay: 550ms">
          <div class="card-header">
            <mat-icon>account_box</mat-icon>
            <h3>Account Details</h3>
          </div>

          <div class="detail-row">
            <span class="label">Username</span>
            <span class="value">{{ user.userName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Verified</span>
            <span class="value" [class.verified]="user.emailConfirmed">
              {{ user.emailConfirmed ? 'Yes' : 'No' }}
            </span>
          </div>
          <div class="detail-row">
            <span class="label">ID Number</span>
            <span class="value">{{ user.identificationNumber || '—' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Security Stamp</span>
            <span class="value stamp">{{ user.securityStamp }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Activity Tab -->
    <section class="tab-panel" *ngIf="activeTab === 'activity'">
      <div class="activity-card animate-on-scroll" style="animation-delay: 300ms">
        <div class="card-header">
          <mat-icon>timeline</mat-icon>
          <div>
            <h3>Recent Activity</h3>
            <p>Important events on your inspector account</p>
          </div>
        </div>

        <div class="timeline">
          <div
            class="timeline-item"
            *ngFor="let item of activity; let i = index"
            [class.animate-on-scroll]="true"
            [style.animation-delay]="(350 + i * 50) + 'ms'"
          >
            <div
              class="timeline-dot"
              [class.success]="item.kind === 'success'"
              [class.info]="item.kind === 'info'"
              [class.warn]="item.kind === 'warn'"
            ></div>

            <div class="timeline-line"></div>

            <div class="timeline-content">
              <div class="timeline-header">
                <span class="title">{{ item.label }}</span>
                <span
                  class="timeline-badge"
                  *ngIf="item.badge"
                  [class.success]="item.kind === 'success'"
                  [class.info]="item.kind === 'info'"
                  [class.warn]="item.kind === 'warn'"
                >
                  {{ item.badge }}
                </span>
              </div>
              <p class="description">{{ item.meta }}</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Security Tab -->
    <section class="tab-panel" *ngIf="activeTab === 'security'">
      <div class="security-grid">

        <div class="security-card animate-on-scroll" style="animation-delay: 300ms">
          <div class="card-header">
            <mat-icon>lock</mat-icon>
            <h3>Password & Login</h3>
          </div>

          <p class="description">
            Change your password regularly and avoid reusing passwords across different platforms.
          </p>

          <div class="info-row">
            <span class="label">Last login</span>
            <span class="value">{{ user.loginDate | date:'medium' }}</span>
          </div>

          <button mat-flat-button color="primary" (click)="changePassword()">
            <mat-icon>lock_reset</mat-icon>
            <span>Change Password</span>
          </button>
        </div>

        <div class="security-card animate-on-scroll" style="animation-delay: 350ms">
          <div class="card-header">
            <mat-icon>shield</mat-icon>
            <h3>Account Safety</h3>
          </div>

          <p class="description">
            Email verification helps keep your account safe and send important inspection updates.
          </p>

          <div class="info-row">
            <span class="label">Email verified</span>
            <span class="value" [class.verified]="user.emailConfirmed">
              {{ user.emailConfirmed ? 'Yes' : 'No' }}
            </span>
          </div>

          <div class="info-row">
            <span class="label">Account status</span>
            <span class="value" [class.active]="user.active">
              {{ user.active ? 'Active' : 'Inactive' }}
            </span>
          </div>

          <div class="security-hint">
            <mat-icon>info</mat-icon>
            <span>Keep your login details private and log out after finishing inspections on shared systems.</span>
          </div>
        </div>

      </div>
    </section>

  </div>
</div>