<!-- src/app/features/bidder-portal/bidder/pages/bidder-change-password/bidder-change-password.html -->

<div class="landing cp-landing" [class.ready]="revealReady">
  <!-- FULL-BLEED HERO (auctions-list parity) -->
  <section
    class="hero-section"
    style="--hero-bg: url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=1920');"
  >
    <div class="hero-overlay"></div>

    <div class="hero-content shell">
      <div class="hero-breadcrumbs">
        <a routerLink="/bidder/dashboard" class="crumb">
          <span class="dot"></span>
          Home
        </a>
        <mat-icon>chevron_right</mat-icon>
        <a routerLink="/bidder/accdetails" class="crumb subtle">Account</a>
        <mat-icon>chevron_right</mat-icon>
        <span class="current">Security</span>
      </div>

      <div class="hero-badge">
        <mat-icon class="badge-ic">security</mat-icon>
        Precision Ritual
      </div>

      <h1 class="hero-title">
        <span class="make">Change</span>
        <span class="model">Password</span>
      </h1>

      <p class="hero-sub">
        Calm, procedural, and verified. Follow the checklist—update, confirm, seal.
      </p>

      <div class="hero-meta">
        <div class="meta-pill">
          <mat-icon>checklist</mat-icon>
          <span>3 steps • one scroll</span>
        </div>

        <div class="meta-pill" [class.live]="strengthLevel === 'elite' || strengthLevel === 'strong'">
          <mat-icon>{{ strengthIcon }}</mat-icon>
          <span>Strength: {{ strengthLabel }}</span>
        </div>

        <div class="meta-pill muted" *ngIf="capsOn">
          <mat-icon>keyboard_capslock</mat-icon>
          <span>Caps Lock is ON</span>
        </div>
      </div>

      <div class="hero-actions">
        <button class="cta-primary" type="button" (click)="scrollToRitual()">
          <span class="btn-inner">
            <mat-icon>lock_reset</mat-icon>
            <span>BEGIN RITUAL</span>
          </span>
        </button>

        <button class="cta-ghost" type="button" (click)="cancel()">
          <mat-icon>arrow_back</mat-icon>
          <span>Return to Account</span>
        </button>
      </div>
    </div>
  </section>

  <!-- STATS BAR (dashboard rhythm) -->
  <section class="stats-bar">
    <div class="shell stats-grid">
      <div class="stat-item reveal">
        <div class="stat-value">
          <span>{{ strengthScore }}</span>
        </div>
        <div class="stat-label">Strength Score</div>
      </div>

      <div class="stat-item reveal">
        <div class="stat-value">
          <span>{{ match ? 'YES' : (confirmPassword ? 'NO' : '—') }}</span>
        </div>
        <div class="stat-label">Confirmation Match</div>
      </div>

      <div class="stat-item reveal">
        <div class="stat-value">
          <span>{{ differentFromCurrent ? 'OK' : 'NO' }}</span>
        </div>
        <div class="stat-label">Not Reused</div>
      </div>

      <div class="stat-item reveal">
        <div class="stat-value">
          <span>{{ canSubmit ? 'READY' : 'HOLD' }}</span>
        </div>
        <div class="stat-label">Seal Status</div>
      </div>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <section class="content-section" #ritual>
    <div class="shell">
      <!-- Ritual Panel -->
      <div class="ritual-grid">
        <!-- LEFT: Checklist / Guidance -->
        <aside class="ritual-aside reveal">
          <div class="aside-card">
            <div class="aside-head">
              <div class="aside-title">
                <mat-icon>fact_check</mat-icon>
                <span>Checklist</span>
              </div>
              <div class="aside-tag" [attr.data-level]="strengthLevel">
                <span class="dot"></span>
                {{ strengthLabel }}
              </div>
            </div>

            <div class="meter">
              <div class="meter-top">
                <div class="meter-label">Strength clarity</div>
                <div class="meter-value">{{ strengthScore }} / 100</div>
              </div>
              <div class="meter-rail">
                <div class="meter-fill" [style.width.%]="strengthScore"></div>
              </div>
              <div class="meter-notes">
                Aim for <b>Strong</b> or <b>Elite</b> for best protection.
              </div>
            </div>

            <ul class="checks">
              <li *ngFor="let r of checklist" [class.ok]="r.ok">
                <mat-icon class="ic">{{ r.ok ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>{{ r.label }}</span>
              </li>
            </ul>

            <div class="breach-note">
              <mat-icon>info</mat-icon>
              <div>
                <div class="t">Breach awareness</div>
                <div class="d">
                  Use a password you haven’t used elsewhere. This keeps your bidder identity isolated and
                  resilient.
                </div>
              </div>
            </div>
          </div>
        </aside>

        <!-- RIGHT: Form (procedural steps) -->
        <main class="ritual-main reveal">
          <div class="panel">
            <div class="panel-head">
              <div class="panel-kicker">SECURITY DESK</div>
              <h2 class="panel-title">Execute change with certainty</h2>
              <p class="panel-sub">
                Follow the sequence below. Clear inputs. Immediate feedback. Final seal.
              </p>
            </div>

            <form #f="ngForm" (ngSubmit)="submit(f)" class="cp-form" novalidate>
              <!-- Step 1 -->
              <section class="step">
                <div class="step-head">
                  <div class="step-num">01</div>
                  <div class="step-text">
                    <div class="step-title">Verify identity</div>
                    <div class="step-desc">Confirm your current credential to authorize the ritual.</div>
                  </div>
                </div>

                <div class="field">
                  <label class="lbl">Current password</label>
                  <div class="control">
                    <input
                      [type]="showCurrent ? 'text' : 'password'"
                      name="currentPassword"
                      [(ngModel)]="currentPassword"
                      required
                      autocomplete="current-password"
                      (keydown)="onKeyState($event)"
                      placeholder="Enter current password"
                    />
                    <button type="button" class="reveal-btn" (click)="showCurrent = !showCurrent" aria-label="Toggle current password">
                      <mat-icon>{{ showCurrent ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                  </div>
                  <div class="hint">This confirms you’re authorized to update security.</div>
                </div>
              </section>

              <div class="divider"></div>

              <!-- Step 2 -->
              <section class="step">
                <div class="step-head">
                  <div class="step-num">02</div>
                  <div class="step-text">
                    <div class="step-title">Define new credential</div>
                    <div class="step-desc">Strong, unique, and easy to verify at a glance.</div>
                  </div>
                </div>

                <div class="field">
                  <label class="lbl">New password</label>
                  <div class="control">
                    <input
                      [type]="showNew ? 'text' : 'password'"
                      name="newPassword"
                      [(ngModel)]="newPassword"
                      required
                      minlength="8"
                      autocomplete="new-password"
                      (keydown)="onKeyState($event)"
                      placeholder="Create a new password"
                    />
                    <button type="button" class="reveal-btn" (click)="showNew = !showNew" aria-label="Toggle new password">
                      <mat-icon>{{ showNew ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                  </div>

                  <div class="inline-status" [attr.data-level]="strengthLevel">
                    <mat-icon class="s-ic">{{ strengthIcon }}</mat-icon>
                    <span class="s-txt">Strength: {{ strengthLabel }}</span>
                    <span class="s-sep">•</span>
                    <span class="s-txt">{{ strengthScore }}/100</span>
                  </div>
                </div>
              </section>

              <div class="divider"></div>

              <!-- Step 3 -->
              <section class="step">
                <div class="step-head">
                  <div class="step-num">03</div>
                  <div class="step-text">
                    <div class="step-title">Confirm & seal</div>
                    <div class="step-desc">Re-enter to validate. Then finalize the secure update.</div>
                  </div>
                </div>

                <div class="field">
                  <label class="lbl">Confirm new password</label>
                  <div class="control">
                    <input
                      [type]="showConfirm ? 'text' : 'password'"
                      name="confirmPassword"
                      [(ngModel)]="confirmPassword"
                      required
                      minlength="8"
                      autocomplete="new-password"
                      (keydown)="onKeyState($event)"
                      placeholder="Re-enter new password"
                    />
                    <button type="button" class="reveal-btn" (click)="showConfirm = !showConfirm" aria-label="Toggle confirm password">
                      <mat-icon>{{ showConfirm ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                  </div>

                  <div class="match-line" [class.ok]="match" *ngIf="confirmPassword">
                    <mat-icon>{{ match ? 'check_circle' : 'error_outline' }}</mat-icon>
                    <span>{{ match ? 'Match verified' : 'Does not match' }}</span>
                  </div>
                </div>

                <div class="seal">
                  <div class="seal-left">
                    <div class="seal-title">
                      <mat-icon>verified_user</mat-icon>
                      Seal integrity
                    </div>
                    <div class="seal-sub">
                      {{ canSubmit ? 'All checks passed. Ready to finalize.' : 'Complete the checklist to finalize.' }}
                    </div>
                  </div>

                  <div class="seal-actions">
                    <button type="button" class="btn-secondary" (click)="cancel()" [disabled]="saving">
                      <mat-icon>close</mat-icon>
                      <span>Cancel</span>
                    </button>

                    <button type="submit" class="btn-primary" [disabled]="!canSubmit">
                      <span class="btn-inner">
                        <mat-icon>{{ saving ? 'hourglass_top' : 'lock_reset' }}</mat-icon>
                        <span>{{ saving ? 'SEALING…' : 'SEAL CHANGE' }}</span>
                      </span>
                    </button>
                  </div>
                </div>
              </section>
            </form>
          </div>

          <div class="closure reveal">
            <div class="closure-card">
              <mat-icon>shield_lock</mat-icon>
              <div>
                <div class="t">Closure</div>
                <div class="d">
                  After sealing, you’ll return to your account cockpit. Security should feel finished—clean,
                  modern, and under control.
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </section>

  <!-- FIXED LOADER (auctions-list parity) -->
  <div class="page-loader" *ngIf="saving">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
</div>
