<div class="product-details" *ngIf="!loading; else busy">
  <!-- crumbs -->
  <div class="crumbs">
    <a routerLink="/bidder/auctions">Auctions</a>
    <mat-icon>chevron_right</mat-icon>
    <a *ngIf="auctionId" [routerLink]="['/bidder/auctions', auctionId]">
      {{ auction?.auctionName || ('Auction #' + auctionId) }}
    </a>
    <mat-icon>chevron_right</mat-icon>
    <span class="current">{{ title }}</span>
  </div>

  <div class="err" *ngIf="error">
    <mat-icon>error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>

  <section class="page" *ngIf="!error">
    <!-- LEFT -->
    <div class="main">
      <div class="media">
        <div class="stage" [ngStyle]="{'--photo': 'url(' + (activeImage || images[0]) + ')'}"></div>

        <div class="thumbs" *ngIf="images.length > 1">
          <button
            class="thumb"
            *ngFor="let img of images"
            [class.active]="img === activeImage"
            [ngStyle]="{'--photo': 'url(' + img + ')'}"
            (click)="selectImage(img)"
            matTooltip="View">
          </button>
        </div>
      </div>

      <div class="title-block">
        <h1>{{ title }}</h1>
        <div class="sub">{{ subtitle }}</div>

        <div class="meta">
          <div class="chip"><span class="label">Reserve</span><span class="value">{{ money(lot?.reservePrice ?? null) }}</span></div>
          <div class="chip"><span class="label">Buy Now</span><span class="value">{{ money(lot?.buyNowPrice ?? null) }}</span></div>
          <div class="chip"><span class="label">Bid Increment</span><span class="value">{{ money(lot?.bidIncrement ?? null) }}</span></div>
          <div class="chip"><span class="label">Auction Window</span><span class="value">{{ formatRange(auction?.startDateTime||null, auction?.endDateTime||null) }}</span></div>
        </div>

        <div class="cta-row">
          <a class="btn primary" [routerLink]="['/bidder/auctions', auctionId, lotId]" matTooltip="Place your bid">
            <mat-icon>gavel</mat-icon> Place Bid
          </a>
          <a class="btn ghost" [routerLink]="['/bidder/auctions', auctionId, lotId]" matTooltip="See bidding activity">
            <mat-icon>visibility</mat-icon> View Auction
          </a>
        </div>
      </div>

      <div class="panel specs">
        <h3>Vehicle details</h3>
        <div class="grid">
          <div class="row" *ngFor="let s of specs">
            <div class="label">{{ s.label }}</div>
            <div class="value">{{ s.value || '—' }}</div>
          </div>
        </div>
      </div>

      <div class="panel" *ngIf="inventory?.description">
        <h3>Description</h3>
        <p class="desc">{{ inventory?.description }}</p>
      </div>
    </div>

    <!-- RIGHT rail -->
    <aside class="sidebar">
      <div class="rail">
        <!-- auction status / schedule -->
        <section class="status">
          <div class="status-top">
            <div class="icon"><mat-icon>schedule</mat-icon></div>
            <div class="labels">
              <div class="kicker">Auction status</div>
              <div class="state">{{ auction?.auctionStatusName || auction?.auctionStatusCode || '—' }}</div>
            </div>
          </div>

          <div class="timegrid">
            <div class="tblock">
              <div class="tlabel">Starts</div>
              <div class="tvalue">{{ auction?.startDateTime ? (auction?.startDateTime | date:'medium') : '—' }}</div>
            </div>
            <div class="tblock">
              <div class="tlabel">Ends</div>
              <div class="tvalue">{{ auction?.endDateTime ? (auction?.endDateTime | date:'medium') : '—' }}</div>
            </div>
          </div>

          <a class="rail-cta" [routerLink]="['/bidder/auctions', auctionId, lotId]">
            <mat-icon>gavel</mat-icon> Bid on this car
          </a>
        </section>

        <!-- related auctions list -->
        <section class="related-rail">
          <div class="r-head">
            <span>Related auctions</span>
          </div>

          <div class="tiles">
            <a class="tile" *ngFor="let r of related" [routerLink]="r.link">
              <div class="thumb" [ngStyle]="{'--photo': 'url(' + r.imageUrl + ')'}"></div>
              <div class="copy">
                <div class="title">{{ r.title }}</div>
                <div class="sub">{{ r.sub }}</div>
                <div class="money">
                  <span *ngIf="r.reserve != null">Reserve {{ money(r.reserve) }}</span>
                  <span *ngIf="r.buyNow != null"> • Buy {{ money(r.buyNow) }}</span>
                </div>
              </div>
            </a>

            <div class="empty" *ngIf="related.length===0">No related listings found.</div>
          </div>
        </section>
      </div>
    </aside>
  </section>
</div>

<ng-template #busy>
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
</ng-template>
