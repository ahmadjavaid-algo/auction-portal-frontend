<div class="auctions-grid-page">
  <!-- Hero Banner -->
  <section
    class="hero-banner"
    [ngStyle]="{ '--hero-img': 'url(' + heroUrl + ')' }"
  >
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="breadcrumbs">
        <a routerLink="/bidder/dashboard">Dashboard</a>
        <mat-icon>chevron_right</mat-icon>
        <span>Favourites</span>
      </div>

      <h1 class="hero-title">Favourites</h1>

      <div class="hero-meta">
        <div class="meta-item">
          <mat-icon>favorite</mat-icon>
          <span>{{ results.length }} Saved Vehicles</span>
        </div>

        <div class="meta-item">
          <mat-icon>inventory_2</mat-icon>
          <span>{{ results.length }} Vehicles</span>
        </div>

        <div class="meta-item status-live" *ngIf="isLive">
          <span class="pulse-dot"></span>
          <span>LIVE BIDDING</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Loading -->
  <div class="loader-wrap" *ngIf="loading">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <span>Loading your favourites...</span>
  </div>

  <!-- Error -->
  <div class="error-banner" *ngIf="!loading && error">
    <mat-icon>error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>

  <!-- Main Content -->
  <div class="main-content" *ngIf="!loading && !error">
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="search-bar">
        <mat-icon>search</mat-icon>
        <input
          type="text"
          placeholder="Search by make, model, year, chassis..."
          [(ngModel)]="q"
        />
        <button
          *ngIf="q"
          class="clear-btn"
          (click)="q = ''"
          matTooltip="Clear search"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="filters-row">
        <div class="filter-group">
          <label>Make</label>
          <select [(ngModel)]="filters.make">
            <option value="">All Makes</option>
            <option *ngFor="let m of options.makes" [value]="m">{{ m }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Model</label>
          <select [(ngModel)]="filters.model">
            <option value="">All Models</option>
            <option *ngFor="let m of options.models" [value]="m">{{ m }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Year</label>
          <select [(ngModel)]="filters.year">
            <option value="">All Years</option>
            <option *ngFor="let y of options.years" [value]="y">{{ y }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Category</label>
          <select [(ngModel)]="filters.category">
            <option value="">All Categories</option>
            <option *ngFor="let c of options.categories" [value]="c">{{ c }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Sort By</label>
          <select [(ngModel)]="sortBy">
            <option value="newest">Newest First</option>
            <option value="price_low">Price: Low to High</option>
            <option value="price_high">Price: High to Low</option>
            <option value="year_new">Year: Newest</option>
            <option value="year_old">Year: Oldest</option>
          </select>
        </div>

        <button
          class="reset-btn"
          *ngIf="
            q ||
            filters.make ||
            filters.model ||
            filters.year ||
            filters.category ||
            sortBy !== 'newest'
          "
          (click)="clearAll()"
        >
          <mat-icon>refresh</mat-icon>
          <span>Reset All</span>
        </button>
      </div>
    </div>

    <!-- Results Count -->
    <div class="results-header">
      <h2>
        {{ results.length }} Vehicle{{ results.length !== 1 ? 's' : '' }} Saved
      </h2>
      <div class="view-toggle">
        <mat-icon>grid_view</mat-icon>
      </div>
    </div>

    <!-- Vehicle Grid -->
    <div class="vehicle-grid" *ngIf="results.length > 0">
      <article
        class="vehicle-card"
        *ngFor="let car of results; trackBy: trackById"
      >
        <!-- Image -->
        <div
          class="card-image"
          [ngStyle]="{ '--car-img': 'url(' + car.imageUrl + ')' }"
        >
          <div class="image-overlay"></div>

          <!-- Countdown Badge -->
          <div class="countdown-badge" [ngClass]="car.countdownState">
            <mat-icon>schedule</mat-icon>
            <span>{{ car.countdownText }}</span>
          </div>

          <!-- Favorite Button -->
          <button
            class="fav-btn"
            [class.active]="car.isFavourite"
            (click)="toggleFavourite(car); $event.stopPropagation()"
            matTooltip="Remove from favorites"
          >
            <mat-icon>favorite</mat-icon>
          </button>

          <!-- Reserve Met Badge -->
          <div
            class="reserve-badge"
            *ngIf="car.reserve != null"
            [class.met]="car.reserveMet"
          >
            <mat-icon>{{ car.reserveMet ? 'check_circle' : 'info' }}</mat-icon>
            <span>{{ car.reserveMet ? 'Reserve Met' : 'Reserve Not Met' }}</span>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <h3 class="car-title">{{ car.title }}</h3>
          <div class="car-subtitle">{{ car.sub }}</div>

          <!-- Price Grid -->
          <div class="price-grid">
            <!-- Current Bid (Hero) -->
            <div class="price-hero" *ngIf="car.currentPrice != null">
              <div class="label">Current Bid</div>
              <div class="value">{{ money(car.currentPrice) }}</div>
              <div class="your-bid" *ngIf="car.yourMaxBid != null">
                Your max: <strong>{{ money(car.yourMaxBid) }}</strong>
              </div>
            </div>

            <!-- Start Price -->
            <div class="price-item" *ngIf="car.auctionStartPrice != null">
              <div class="label">Start Price</div>
              <div class="value">{{ money(car.auctionStartPrice) }}</div>
            </div>

            <!-- Buy Now -->
            <div class="price-item" *ngIf="car.buyNow != null">
              <div class="label">Buy Now</div>
              <div class="value">{{ money(car.buyNow) }}</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="card-actions">
            <!-- Quick Bid (Primary CTA) -->
            <button
              class="btn-quick-bid"
              [disabled]="
                car.countdownState !== 'live' ||
                car.placingBid ||
                car.bidCooldownActive
              "
              (click)="onQuickBid(car)"
              matTooltip="Quick bid: Add one increment to current price"
            >
              <span class="btn-inner">
                <mat-icon>flash_on</mat-icon>
                <span *ngIf="!car.bidCooldownActive && !car.placingBid"
                  >QUICK BID</span
                >
                <span *ngIf="car.bidCooldownActive"
                  >PENDING {{ car.bidCooldownRemaining }}s</span
                >
                <span *ngIf="car.placingBid">PLACING...</span>
              </span>
            </button>

            <!-- Secondary Actions -->
            <div class="btn-group">
              <a
                class="btn-details"
                [routerLink]="[
                  '/bidder/auctions',
                  car.auctionId,
                  car.invAuc.inventoryAuctionId,
                  'details'
                ]"
                matTooltip="View full details"
              >
                <mat-icon>description</mat-icon>
                <span>Details</span>
              </a>

              <a
                class="btn-open"
                [routerLink]="[
                  '/bidder/auctions',
                  car.auctionId,
                  car.invAuc.inventoryAuctionId
                ]"
                matTooltip="Open bidding page"
              >
                <mat-icon>gavel</mat-icon>
                <span>Bid</span>
              </a>
            </div>
          </div>

          <!-- Cooldown Popup -->
          <div class="cooldown-popup" *ngIf="car.bidCooldownActive">
            <div class="cooldown-content">
              <div class="cooldown-text">
                <strong>Placing bid in {{ car.bidCooldownRemaining }}s</strong>
                <span>Click cancel if you've changed your mind</span>
              </div>
              <button class="btn-cancel" (click)="cancelQuickBid(car)">
                Cancel
              </button>
            </div>
            <div class="cooldown-progress">
              <div
                class="progress-fill"
                [style.width.%]="(car.bidCooldownRemaining || 0) * 20"
              ></div>
            </div>
          </div>
        </div>
      </article>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="results.length === 0">
      <mat-icon>favorite_border</mat-icon>
      <h3>You have no saved vehicles</h3>
      <p>Browse auctions and tap the heart icon to add favourites</p>
      <button class="btn-reset" routerLink="/bidder/auctions">
        <mat-icon>search</mat-icon>
        <span>Browse Auctions</span>
      </button>
    </div>
  </div>
</div>
